<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LaamSocial Login / Register</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="auth-container">
  <h2>LaamSocial</h2>

  <!-- Registration Form -->
  <div id="registerForm">
    <h3>Register</h3>
    <input type="text" id="regFullName" placeholder="Full Name" required>
    <input type="text" id="regUsername" placeholder="Username" required>
    <input type="email" id="regEmail" placeholder="Email" required>
    <input type="password" id="regPassword" placeholder="Password" required>
    <button type="button" id="registerBtn">Register</button>
    <p>Already have an account? <span id="showLogin" style="cursor:pointer; color:blue;">Login</span></p>
  </div>

  <!-- Login Form -->
  <div id="loginForm" style="display:none;">
    <h3>Login</h3>
    <input type="email" id="loginEmail" placeholder="Email" required>
    <input type="password" id="loginPassword" placeholder="Password" required>
    <button type="button" id="loginBtn">Login</button>
    <p>Don't have an account? <span id="showRegister" style="cursor:pointer; color:blue;">Register</span></p>
  </div>
</div>

<script type="module">
  // -------- Firebase Setup --------
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
  import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDy_GTVZvwCZp8eLYvd_TUPI-uo_Jp5MpY",
    authDomain: "laamsocial-98cce.firebaseapp.com",
    projectId: "laamsocial-98cce",
    storageBucket: "laamsocial-98cce.appspot.com",
    messagingSenderId: "649707204234",
    appId: "1:649707204234:web:2f22441b4dbbacc5674773"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // -------- DOM Elements --------
  const registerBtn = document.getElementById("registerBtn");
  const loginBtn = document.getElementById("loginBtn");

  const regFullName = document.getElementById("regFullName");
  const regUsername = document.getElementById("regUsername");
  const regEmail = document.getElementById("regEmail");
  const regPassword = document.getElementById("regPassword");

  const loginEmail = document.getElementById("loginEmail");
  const loginPassword = document.getElementById("loginPassword");

  const showLogin = document.getElementById("showLogin");
  const showRegister = document.getElementById("showRegister");

  const registerForm = document.getElementById("registerForm");
  const loginForm = document.getElementById("loginForm");

  // -------- Toggle Forms --------
  showLogin.addEventListener("click", ()=>{
    registerForm.style.display="none";
    loginForm.style.display="block";
  });
  showRegister.addEventListener("click", ()=>{
    loginForm.style.display="none";
    registerForm.style.display="block";
  });

  // -------- Register --------
  registerBtn.addEventListener("click", async ()=>{
    const fullName = regFullName.value.trim();
    const username = regUsername.value.trim();
    const email = regEmail.value.trim();
    const password = regPassword.value.trim();

    if(!fullName || !username || !email || !password){ 
      alert("Please fill all fields"); 
      return; 
    }

    // Check username uniqueness
    const usersSnapshot = await getDocs(collection(db,"users"));
    const usernameExists = usersSnapshot.docs.some(doc => doc.data().username === username);
    if(usernameExists){ 
      alert("Username already taken"); 
      return; 
    }

    try{
      const userCredential = await createUserWithEmailAndPassword(auth,email,password);
      const user = userCredential.user;

      // Save user info in Firestore
      await addDoc(collection(db,"users"),{
        uid: user.uid,
        fullName,
        username,
        email,
        lastSeen: null
      });

      // Redirect to dashboard
      window.location.href="dashboard.html";
    }catch(error){
      alert(error.message);
    }
  });

  // -------- Login --------
  loginBtn.addEventListener("click", async ()=>{
    const email = loginEmail.value.trim();
    const password = loginPassword.value.trim();
    if(!email || !password){ 
      alert("Please fill all fields"); 
      return; 
    }

    try{
      await signInWithEmailAndPassword(auth,email,password);
      window.location.href="dashboard.html";
    }catch(error){
      alert(error.message);
    }
  });

  // -------- Auto Redirect if Logged In --------
  onAuthStateChanged(auth, user=>{
    if(user){
      window.location.href="dashboard.html";
    }
  });
</script>
</body>
</html>
